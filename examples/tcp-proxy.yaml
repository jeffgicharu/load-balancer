# TCP Database Proxy
# Load balance TCP connections to database servers

global:
  log_level: info
  log_format: json

frontends:
  - name: postgres
    listen: "0.0.0.0:5432"
    protocol: tcp
    backend: postgres-servers
    algorithm: least_connections
    tcp:
      connect_timeout: 5s

  - name: redis
    listen: "0.0.0.0:6379"
    protocol: tcp
    backend: redis-servers
    algorithm: round_robin

backends:
  - name: postgres-servers
    servers:
      - address: "10.0.0.10:5432"
      - address: "10.0.0.11:5432"
    health_check:
      type: tcp
      interval: 5s
      timeout: 2s

  - name: redis-servers
    servers:
      - address: "10.0.0.20:6379"
      - address: "10.0.0.21:6379"
      - address: "10.0.0.22:6379"
    health_check:
      type: tcp
      interval: 3s
      timeout: 1s
